{% extends '_base.html' %}
{% load thaidate %}

{% block title %}COVID19 :: RTAF Report and Tracking COVID-19 Patient{% endblock %}

{% block content %}
    <div class="row">                                    
        <div class="col-lg-12">
            <div id="UnitChart"></div>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-12">
            <div id="WeekChart"></div>
        </div>
    </div>
{% endblock %}

{% block script %}

<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

<script type="text/javascript">
// Load google charts
google.charts.load('current', {'packages':['corechart']});
google.charts.setOnLoadCallback(drawChart);

// Draw the chart and set the chart values
function drawChart() {
    var data = google.visualization.arrayToDataTable([        
        ['Element', 'Density', { role: 'style' }, { role: 'link' } ],
        {% for patient_count in PatientCount %}
            [
             '{{ patient_count.Date|thaidate:"D d"  }}', 
             {{ patient_count.NumPatient }},
             {% if patient_count.week_day == 1 %} 
                'red'
             {% elif patient_count.week_day == 2 %} 
                'yellow' 
             {% elif patient_count.week_day == 3 %} 
                'pink'
             {% elif patient_count.week_day == 4 %} 
                'green' 
             {% elif patient_count.week_day == 5 %} 
                'orange' 
             {% elif patient_count.week_day == 6 %} 
                'blue' 
             {% elif patient_count.week_day == 7 %} 
                'purple' 
             {% endif %}
             ,'/0/List?date={{ patient_count.Date|date:"Y-m-d"  }}'
     
            ],

        {% endfor %}        
    ]);

    var view = new google.visualization.DataView(data);
      view.setColumns([0, 1,
                       { calc: "stringify",
                         sourceColumn: 1,
                         type: "string",
                         role: "annotation" },
                       2]);
  
    var options = {
            title: "จำนวนผู้ป่วยย้อนหลัง {{ NumDay }} วัน",
            width: '100%',
            height: 500,
            bar: {groupWidth: "60%"},
            legend: { position: "left" },
        };

    var chart = new google.visualization.ColumnChart(document.getElementById("WeekChart"));
    chart.draw(view, options);

    google.visualization.events.addListener(chart, 'select', function (e) {
            var selection = chart.getSelection();
                if (selection.length) {
                    var row = selection[0].row;
                    let link =data.getValue(row, 3);
                    location.href = link;
                }
        });

    var dataUnit = google.visualization.arrayToDataTable([        
        ['Element', 'Density', { role: 'style' }, { role: 'link' }],
        {% for patient_count in UnitCount %}
            [
             '{{ patient_count.Office  }}', 
             {{ patient_count.NumPatient }},   

                {% if patient_count.NumPatient < 4 %}
                   'RGB(254, 240, 1)'
                {% elif  patient_count.NumPatient <  7 %}
                    'RGB(253, 154, 1)'
                {% elif   patient_count.NumPatient < 12 %}
                    'RGB(253, 97, 4)'
                {% else %}  
                    'RGB(240, 5, 5)'          
                {% endif %}
                ,'/0/List?Office={{ patient_count.Office}}'
            ],
        {% endfor %}        
    ]);

    var viewUnit = new google.visualization.DataView(dataUnit);
      viewUnit.setColumns([0, 1,
                       { calc: "stringify",
                         sourceColumn: 1,
                         type: "string",
                         role: "annotation" },
                       2]);
  
    var optionsUnit = {
            title: "ขรก.ประจำ ย้อนหลัง {{ NumDay }} วัน",
            width: '100%',
            height: 500,
            bar: {groupWidth: "60%"},
            legend: { position: "left" },
        };

    var chartUnit = new google.visualization.ColumnChart(document.getElementById("UnitChart"));
    chartUnit.draw(viewUnit, optionsUnit);

    google.visualization.events.addListener(chartUnit, 'select', function (e) {
            var selection = chartUnit.getSelection();
                if (selection.length) {
                    var row = selection[0].row;
                    let link = dataUnit.getValue(row, 3);
                    location.href = link;
                }
        });
}
</script>

{% endblock %}
